#!/bin/bash

# Pre-push hookï¼šé˜²æ­¢ç›´æ¥æ¨é€åˆ° main æˆ– master åˆ†æ”¯
# é€™å€‹ hook èˆ‡ git-secrets çš„ pre-commit hook äº’è£œ
# - git-secrets: é˜²æ­¢æäº¤æ©Ÿæ•è³‡è¨Š
# - pre-push: å¼·åˆ¶ä½¿ç”¨ Pull Request æµç¨‹

# é¡è‰²å®šç¾©
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# å¾ stdin è®€å–æ¨é€è³‡è¨Š
# -r flag: é˜²æ­¢åæ–œç·šè¢«è§£é‡‹ç‚ºè½‰ç¾©å­—å…ƒ
# ä½¿ç”¨ _ å‰ç¶´è¡¨ç¤ºæœ‰æ„ä¸ä½¿ç”¨çš„è®Šæ•¸ï¼ˆç¬¦åˆ ShellCheck å»ºè­°ï¼‰
while read -r _local_ref _local_sha remote_ref _remote_sha
do
  # æª¢æŸ¥æ˜¯å¦æ¨é€åˆ° main æˆ– master åˆ†æ”¯
  if [ "$remote_ref" = "refs/heads/main" ] || [ "$remote_ref" = "refs/heads/master" ]; then
    echo ""
    echo "${RED}âŒ ============================================${NC}"
    echo "${RED}âŒ  ç¦æ­¢ç›´æ¥æ¨é€åˆ° protected åˆ†æ”¯ï¼${NC}"
    echo "${RED}âŒ ============================================${NC}"
    echo ""
    echo "${BLUE}ğŸ“‹ è«‹ä½¿ç”¨ä»¥ä¸‹ Pull Request æµç¨‹ï¼š${NC}"
    echo "   ${GREEN}1.${NC} git checkout -b feature/your-feature-name"
    echo "   ${GREEN}2.${NC} é€²è¡Œé–‹ç™¼ä¸¦ commit"
    echo "   ${GREEN}3.${NC} git push -u origin feature/your-feature-name"
    echo "   ${GREEN}4.${NC} åœ¨ GitHub ä¸Šå»ºç«‹ Pull Request"
    echo ""
    echo "${YELLOW}ğŸ’¡ å¦‚æœé€™æ˜¯ç·Šæ€¥ä¿®å¾©ï¼ˆç·Šæ€¥æƒ…æ³ä½¿ç”¨ï¼‰ï¼š${NC}"
    echo "   git push --no-verify"
    echo ""
    echo "${BLUE}ğŸ›¡ï¸  ä¿è­·æ©Ÿåˆ¶ï¼š${NC}"
    echo "   â€¢ git-secrets: é˜²æ­¢æ©Ÿæ•è³‡è¨Šå¤–æ´©"
    echo "   â€¢ pre-push: ç¢ºä¿ç¨‹å¼ç¢¼å¯©æŸ¥æµç¨‹"
    echo ""
    exit 1
  fi
done

exit 0
