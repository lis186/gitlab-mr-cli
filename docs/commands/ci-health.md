# ci-health

CI/CD å¥åº·åº¦åˆ†æï¼Œè©•ä¼° Pipeline æˆåŠŸç‡ã€åŸ·è¡Œæ™‚é–“èˆ‡å¤±æ•—åŸå› ã€‚

## ç”¨é€”

- åˆ†æ Pipeline æˆåŠŸç‡
- è©•ä¼°å¹³å‡åŸ·è¡Œæ™‚é–“
- åˆ†é¡å¤±æ•—åŸå› ï¼ˆTest / Build / Linting / Deployï¼‰
- è­˜åˆ¥æœ€å¸¸å¤±æ•—çš„ Job

## ä½¿ç”¨æ–¹å¼

```bash
# åˆ†ææœ€è¿‘ 30 å¤©
gitlab-mr ci-health -p your-team/your-project

# åˆ†ææœ€è¿‘ 7 å¤©
gitlab-mr ci-health -p your-team/your-project --period 7d

# åˆ†ææœ€è¿‘ 90 å¤©
gitlab-mr ci-health -p your-team/your-project --period 90d

# é™åˆ¶ Pipeline æ•¸é‡
gitlab-mr ci-health -p your-team/your-project --limit 50

# JSON è¼¸å‡º
gitlab-mr ci-health -p your-team/your-project --json

# è©³ç´°æ¨¡å¼
gitlab-mr ci-health -p your-team/your-project --verbose
```

## åƒæ•¸èªªæ˜

| åƒæ•¸ | èªªæ˜ |
|------|------|
| `-p, --project` | GitLab å°ˆæ¡ˆï¼ˆID æˆ–è·¯å¾‘ï¼‰ |
| `-t, --token` | GitLab Tokenï¼ˆæˆ–ç”¨ç’°å¢ƒè®Šæ•¸ `GITLAB_TOKEN`ï¼‰ |
| `-h, --host` | GitLab URLï¼ˆé è¨­ `https://gitlab.com`ï¼‰ |
| `--period` | åˆ†ææœŸé–“ï¼ˆæ ¼å¼ï¼š`7d` / `30d` / `90d`ï¼Œé è¨­ 30dï¼‰ |
| `--limit` | é™åˆ¶ Pipeline æ•¸é‡ |
| `--json` | JSON æ ¼å¼è¼¸å‡º |
| `-v, --verbose` | è©³ç´°è¼¸å‡º |

## è¼¸å‡ºç¯„ä¾‹

### åŸºæœ¬è¼¸å‡ºï¼ˆé è¨­ï¼‰

```bash
gitlab-mr ci-health -p your-team/your-project
```

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CI/CD å¥åº·åº¦å ±å‘Šï¼ˆæœ€è¿‘ 30 å¤©ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Pipeline æˆåŠŸç‡ï¼š87% (156/179) å¥åº·

âš ï¸ å¹³å‡åŸ·è¡Œæ™‚é–“ï¼š12 åˆ† 35 ç§’ è­¦å‘Š

ğŸ“Š çµ±è¨ˆè³‡è¨Š:
  - ç¸½ Pipeline æ•¸: 179
  - å·²å®Œæˆ: 179
  - åŸ·è¡Œä¸­: 0
  - ä¸­ä½æ•¸åŸ·è¡Œæ™‚é–“: 10 åˆ†é˜

ğŸ“Š å¤±æ•—åŸå› åˆ†æï¼ˆ23 æ¬¡å¤±æ•—ï¼‰:
  1. æ¸¬è©¦å¤±æ•— (52%):	12 æ¬¡
     ç¯„ä¾‹: test-unit, test-integration
  2. å»ºç½®å¤±æ•— (30%):	7 æ¬¡
     ç¯„ä¾‹: build-app, compile
  3. Linting éŒ¯èª¤ (13%):	3 æ¬¡
     ç¯„ä¾‹: lint-check
  4. å…¶ä»– (4%):	1 æ¬¡

âš ï¸  æœ€å¸¸å¤±æ•—çš„ Job:
  - test-unit (8 æ¬¡ï¼Œå¤±æ•—ç‡ 15%)
    å»ºè­°: æª¢æŸ¥æ¸¬è©¦ç©©å®šæ€§
  - build-app (5 æ¬¡ï¼Œå¤±æ•—ç‡ 9%)
    å»ºè­°: æª¢æŸ¥å»ºç½®è¨­å®š

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### åŠ ä¸Š `--verbose`ï¼ˆè©³ç´°æ¨¡å¼ï¼‰

```bash
gitlab-mr ci-health -p your-team/your-project --verbose
```

é¡å¤–é¡¯ç¤ºï¼š
```
è©³ç´°å¤±æ•—åˆ†æ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æœ€è¿‘å¤±æ•—çš„ Pipeline:
  Pipeline #12345 (11/25 14:30)
    å¤±æ•— Job: test-unit
    éŒ¯èª¤è¨Šæ¯: "Expected 200 but got 500"
    æŒçºŒæ™‚é–“: 8 åˆ† 20 ç§’

  Pipeline #12340 (11/24 09:15)
    å¤±æ•— Job: build-app
    éŒ¯èª¤è¨Šæ¯: "Module not found: @types/node"
    æŒçºŒæ™‚é–“: 3 åˆ† 45 ç§’

åŸ·è¡Œæ™‚é–“åˆ†ä½ˆ:
  < 5 åˆ†é˜:   45 (25%)
  5-10 åˆ†é˜:  80 (45%)
  10-20 åˆ†é˜: 42 (23%)
  > 20 åˆ†é˜:  12 (7%)  âš ï¸ éœ€å„ªåŒ–
```

### ä¸åŒæ™‚é–“ç¯„åœ

```bash
# æœ€è¿‘ 7 å¤©ï¼ˆå¿«é€Ÿæª¢æŸ¥ï¼‰
gitlab-mr ci-health -p your-team/your-project --period 7d

# æœ€è¿‘ 90 å¤©ï¼ˆé•·æœŸè¶¨å‹¢ï¼‰
gitlab-mr ci-health -p your-team/your-project --period 90d
```

90 å¤©è¼¸å‡ºé¡å¤–é¡¯ç¤ºï¼š
```
æœˆåº¦è¶¨å‹¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æœˆä»½        æˆåŠŸç‡    å¹³å‡æ™‚é–“    è®ŠåŒ–
  2025-09     82%       15m         -
  2025-10     85%       13m         â†‘ æ”¹å–„
  2025-11     87%       12m         â†‘ æ”¹å–„
```

### åŠ ä¸Š `--json`ï¼ˆJSON è¼¸å‡ºï¼‰

```bash
gitlab-mr ci-health -p your-team/your-project --json
```

```json
{
  "period": "30d",
  "successRate": 0.87,
  "totalPipelines": 179,
  "avgDuration": 755,
  "failureReasons": {
    "test": 12,
    "build": 7,
    "lint": 3,
    "other": 1
  },
  "topFailingJobs": [
    { "name": "test-unit", "failures": 8, "failureRate": 0.15 }
  ]
}
```

### è¼¸å‡ºæ ¼å¼æ¯”è¼ƒ

| åƒæ•¸ | è¼¸å‡ºå…§å®¹ |
|------|----------|
| ï¼ˆé è¨­ï¼‰ | æˆåŠŸç‡ + åŸ·è¡Œæ™‚é–“ + å¤±æ•—åŸå›  + æœ€å¸¸å¤±æ•— Job |
| `--verbose` | + è©³ç´°å¤±æ•—åˆ†æ + åŸ·è¡Œæ™‚é–“åˆ†ä½ˆ |
| `--period 90d` | + æœˆåº¦è¶¨å‹¢ |
| `--json` | JSON æ ¼å¼ï¼ˆé©åˆè‡ªå‹•åŒ–ï¼‰ |

## å¥åº·åº¦æŒ‡æ¨™

### æˆåŠŸç‡

| ç‹€æ…‹ | æˆåŠŸç‡ |
|------|--------|
| å¥åº· | â‰¥ 90% |
| è­¦å‘Š | 80-90% |
| å±éšª | < 80% |

### åŸ·è¡Œæ™‚é–“

| ç‹€æ…‹ | å¹³å‡åŸ·è¡Œæ™‚é–“ |
|------|--------------|
| å¥åº· | < 10 åˆ†é˜ |
| è­¦å‘Š | 10-20 åˆ†é˜ |
| å±éšª | > 20 åˆ†é˜ |
